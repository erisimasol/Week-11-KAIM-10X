<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#4A49B0',
                    },
                },
            },
        };
    </script>
    <style>
        .dark {
            --bg-color: #181818;
            --text-color: #ffffff;
            --card-bg: #242424;
            --border-color: #333333;
        }
        
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --card-bg: #f5f5f5;
            --border-color: #e5e5e5;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
        }
        
        .loader {
            border-top-color: #5D5CDE;
            animation: spinner 0.6s linear infinite;
        }
        
        @keyframes spinner {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-primary">Stock Price Predictor</h1>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                <svg id="dark-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
                <svg id="light-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
                <div class="card rounded-lg shadow-md p-4 border mb-6">
                    <div class="flex flex-col md:flex-row justify-between mb-4 items-start md:items-center">
                        <h2 class="text-xl font-semibold mb-2 md:mb-0">Price History</h2>
                        <div class="flex flex-wrap gap-2">
                            <button data-range="30" class="time-range-btn px-3 py-1 rounded-md text-sm bg-primary text-white">1M</button>
                            <button data-range="90" class="time-range-btn px-3 py-1 rounded-md text-sm bg-gray-200 dark:bg-gray-700">3M</button>
                            <button data-range="180" class="time-range-btn px-3 py-1 rounded-md text-sm bg-gray-200 dark:bg-gray-700">6M</button>
                            <button data-range="365" class="time-range-btn px-3 py-1 rounded-md text-sm bg-gray-200 dark:bg-gray-700">1Y</button>
                            <button data-range="all" class="time-range-btn px-3 py-1 rounded-md text-sm bg-gray-200 dark:bg-gray-700">All</button>
                        </div>
                    </div>
                    <div class="relative" style="height: 400px; width: 100%;">
                        <canvas id="priceChart"></canvas>
                        <div id="chart-loader" class="absolute inset-0 flex items-center justify-center bg-white/75 dark:bg-gray-800/75 z-10">
                            <div class="loader w-12 h-12 border-4 border-gray-300 rounded-full"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card rounded-lg shadow-md p-4 border">
                    <h2 class="text-xl font-semibold mb-4">Price Prediction</h2>
                    
                    <div class="relative" style="height: 300px; width: 100%;">
                        <canvas id="predictionChart"></canvas>
                        <div id="prediction-loader" class="absolute inset-0 flex items-center justify-center bg-white/75 dark:bg-gray-800/75 z-10 hidden">
                            <div class="loader w-12 h-12 border-4 border-gray-300 rounded-full"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Prediction Method</label>
                            <select id="prediction-method" class="w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-base">
                                <option value="sma">Simple Moving Average</option>
                                <option value="ema">Exponential Moving Average</option>
                                <option value="lr">Linear Regression</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Days to Predict</label>
                            <div class="flex gap-2">
                                <input type="number" id="prediction-days" class="w-full p-2 border rounded-md bg-white dark:bg-gray-700 text-base" min="1" max="30" value="7">
                                <button id="predict-btn" class="px-4 py-2 bg-primary hover:bg-secondary text-white rounded-md">
                                    Predict
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="lg:col-span-1">
                <div class="card rounded-lg shadow-md p-4 border mb-6">
                    <h2 class="text-xl font-semibold mb-4">Statistics</h2>
                    <div id="stats-container" class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-sm">Current Price:</span>
                            <span id="current-price" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Open Price:</span>
                            <span id="open-price" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">High:</span>
                            <span id="high-price" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Low:</span>
                            <span id="low-price" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Volume:</span>
                            <span id="volume" class="font-medium">0</span>
                        </div>
                        <div class="border-t my-2"></div>
                        <div class="flex justify-between">
                            <span class="text-sm">Change (1d):</span>
                            <span id="price-change" class="font-medium">0.00%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">30d Average:</span>
                            <span id="avg-30d" class="font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">Volatility (30d):</span>
                            <span id="volatility" class="font-medium">0.00%</span>
                        </div>
                    </div>
                </div>
                
                <div class="card rounded-lg shadow-md p-4 border">
                    <h2 class="text-xl font-semibold mb-4">Predicted Values</h2>
                    <div id="prediction-stats" class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm">1 Day Forecast:</span>
                            <span id="pred-1d" class="font-medium">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">7 Day Forecast:</span>
                            <span id="pred-7d" class="font-medium">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">14 Day Forecast:</span>
                            <span id="pred-14d" class="font-medium">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm">30 Day Forecast:</span>
                            <span id="pred-30d" class="font-medium">--</span>
                        </div>
                        <div class="border-t my-2"></div>
                        <div class="flex justify-between">
                            <span class="text-sm">Prediction Confidence:</span>
                            <span id="pred-confidence" class="font-medium">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Parse the CSV data
        const csvData = `Date,Open,High,Low,Close,Volume,Dividends,Stock Splits
2015-02-27 00:00:00-05:00,13.7933330535888,13.9033327102661,13.5200004577636,13.5559997558593,58231500,0,0
2015-03-02 00:00:00-05:00,13.5133333206176,13.5559997558593,13.0553331375122,13.1553325653076,118831500,0,0
2015-03-03 00:00:00-05:00,13.1206674575805,13.3493328094482,13.0213327407836,13.3039999008178,66484500,0,0
2015-03-04 00:00:00-05:00,13.283332824707,13.5013332366943,13.1473331451416,13.4960002899169,63330000,0,0
2015-03-05 00:00:00-05:00,13.5233325958251,13.7460002899169,13.3433332443237,13.3753328323364,73155000,0,0
2015-03-06 00:00:00-05:00,13.2806673049926,13.3833332061767,12.8100004196167,12.9253330230712,100686000,0,0
2015-03-09 00:00:00-04:00,12.9593334197998,12.9659996032714,12.5500001907348,12.7253332138061,101050500,0,0
2015-03-10 00:00:00-04:00,12.5640001296997,12.8999996185302,12.5066671371459,12.6879997253417,83695500,0,0
2015-03-11 00:00:00-04:00,12.743332862854,13.0786666870117,12.7340002059936,12.9160003662109,74623500,0,0
2015-03-12 00:00:00-04:00,12.9166669845581,12.9633331298828,12.6499996185302,12.7379999160766,62239500,0,0
2015-03-13 00:00:00-04:00,12.5966672897338,12.783332824707,12.4879999160766,12.5786666870117,81514500,0,0
2015-03-16 00:00:00-04:00,12.8000001907348,13.0606670379638,12.6533327102661,13.046667098999,84432000,0,0
2015-03-17 00:00:00-04:00,13.0286674499511,13.247332572937,12.9293327331542,12.9820003509521,73411500,0,0
2015-03-18 00:00:00-04:00,12.997332572937,13.3920001983642,12.873999595642,13.380666732788,72313500,0,0
2015-03-19 00:00:00-04:00,13.4666671752929,13.6393327713012,12.9686670303344,13.0433330535888,127128000,0,0
2015-03-20 00:00:00-04:00,13.1633329391479,13.2659997940063,13.0413331985473,13.2053327560424,64042500,0,0
2015-03-23 00:00:00-04:00,13.2333326339721,13.3666667938232,13.1646671295166,13.3086671829223,39474000,0,0
2015-03-24 00:00:00-04:00,13.4386672973632,13.5860004425048,13.3166666030883,13.4479999542236,54748500,0,0
2015-03-25 00:00:00-04:00,13.2180004119873,13.2393331527709,12.8466672897338,12.9533329010009,85956000,0,0
2015-03-26 00:00:00-04:00,12.9280004501342,12.9860000610351,12.6466665267944,12.6940002441406,61920000,0,0
2015-03-27 00:00:00-04:00,12.6046667098999,12.6193332672119,12.0933332443237,12.3333330154418,129073500,0,0
2015-03-30 00:00:00-04:00,12.3900003433227,12.8166666030883,12.119999885559,12.7046670913696,151342500,0,0
2015-03-31 00:00:00-04:00,12.902000427246,12.9173326492309,12.5606670379638,12.5846672058105,75399000,0,0
2015-04-01 00:00:00-04:00,12.579999923706,12.8199996948242,12.4033327102661,12.5059995651245,56919000,0,0
2015-04-02 00:00:00-04:00,12.6820001602172,12.8819999694824,12.6666669845581,12.7333326339721,75156000,0,0
2015-04-06 00:00:00-04:00,13.1999998092651,13.8500003814697,13.1666669845581,13.539999961853,186837000,0,0
2015-04-07 00:00:00-04:00,13.5006666183471,13.6706666946411,13.4093332290649,13.5500001907348,65218500,0,0
2015-04-08 00:00:00-04:00,13.8800001144409,14.0600004196167,13.7246665954589,13.8446674346923,94546500,0,0
2015-04-09 00:00:00-04:00,13.8953332901,14.0246667861938,13.7413330078125,14.0059995651245,57003000,0,0
2015-04-10 00:00:00-04:00,13.9899997711181,14.1099996566772,13.9333333969116,14.0600004196167,61015500,0,0
2015-04-13 00:00:00-04:00,14.029333114624,14.1999998092651,13.9366674423217,13.9853334426879,56373000,0,0
2015-04-14 00:00:00-04:00,13.9046669006347,13.9659996032714,13.6999998092651,13.8306665420532,45390000,0,0
2015-04-15 00:00:00-04:00,13.8306665420532,13.9726667404174,13.7733325958251,13.855333328247,29286000,0,0
2015-04-16 00:00:00-04:00,13.8466672897338,13.9446668624877,13.7526674270629,13.7799997329711,24886500,0,0
2015-04-17 00:00:00-04:00,13.6660003662109,13.7919998168945,13.5666666030883,13.78600025177,37048500,0,0
2015-04-20 00:00:00-04:00,13.7853326797485,13.8566665649414,13.5900001525878,13.6846666336059,38389500,0,0
2015-04-21 00:00:00-04:00,13.7200002670288,14.0500001907348,13.6206674575805,13.9606666564941,51487500,0,0
2015-04-22 00:00:00-04:00,14.1666669845581,14.7919998168945,14.1126670837402,14.6293325424194,117945000,0,0
2015-04-23 00:00:00-04:00,14.5513334274292,14.7653331756591,14.4766674041748,14.57333278656,66168000,0,0
2015-04-24 00:00:00-04:00,14.6999998092651,14.7200002670288,14.5340003967285,14.5620002746582,36417000,0,0
2015-04-27 00:00:00-04:00,14.8373327255249,15.9166669845581,14.8000001907348,15.4366674423217,175089000,0,0
2015-04-28 00:00:00-04:00,15.6499996185302,15.6999998092651,15.2019996643066,15.3653326034545,91281000,0,0
2015-04-29 00:00:00-04:00,15.336667060852,15.6646671295166,15.1753330230712,15.4966669082641,59041500,0,0
2015-04-30 00:00:00-04:00,15.35933303833,15.5260000228881,15.0113334655761,15.0699996948242,58678500,0,0
2015-05-01 00:00:00-04:00,15.3293333053588,15.4513330459594,14.6940002441406,15.0686674118042,79225500,0,0
2015-05-04 00:00:00-04:00,15.2119998931884,15.6486673355102,15.1406669616699,15.3673334121704,66519000,0,0
2015-05-05 00:00:00-04:00,15.8506669998168,15.9666671752929,15.275333404541,15.5299997329711,86953500,0,0
2015-05-06 00:00:00-04:00,15.6066665649414,15.6313333511352,15.2133331298828,15.362000465393,79063500,0,0
2015-05-07 00:00:00-04:00,14.7333326339721,15.8319997787475,14.6833333969116,15.7866668701171,141838500,0,0
2015-05-08 00:00:00-04:00,15.7326669692993,15.8940000534057,15.579999923706,15.7740001678466,70023000,0,0
2015-05-11 00:00:00-04:00,15.7526674270629,16.1919994354248,15.6873331069946,15.9659996032714,85084500,0,0
2015-05-12 00:00:00-04:00,16.0073337554931,16.4233322143554,15.8793325424194,16.3159999847412,95451000,0,0
2015-05-13 00:00:00-04:00,16.5073337554931,16.5533332824707,16.1499996185302,16.2119998931884,81603000,0,0
2015-05-14 00:00:00-04:00,16.3213329315185,16.326000213623,16.0833320617675,16.2733325958251,43438500,0,0
2015-05-15 00:00:00-04:00,16.261999130249,16.626667022705,16.1666679382324,16.5893325805664,67914000,0,0
2015-05-18 00:00:00-04:00,16.4666671752929,16.6599998474121,16.3999996185302,16.5833320617675,50298000,0,0
2015-05-19 00:00:00-04:00,16.5620002746582,16.7333335876464,16.4099998474121,16.4759998321533,55113000,0,0
2015-05-20 00:00:00-04:00,16.4753322601318,16.5160007476806,16.0913333892822,16.2900009155273,56334000,0,0
2015-05-21 00:00:00-04:00,16.2019996643066,16.4413337707519,16.1573333740234,16.3746662139892,29559000,0,0
2015-05-22 00:00:00-04:00,16.3586673736572,16.5733337402343,16.333999633789,16.5153331756591,33346500,0,0
2015-05-26 00:00:00-04:00,16.511999130249,16.7999992370605,16.4333324432373,16.4973335266113,52480500,0,0
2015-05-27 00:00:00-04:00,16.5673332214355,16.6333332061767,16.3700008392334,16.4953327178955,51123000,0,0
2015-05-28 00:00:00-04:00,16.4686660766601,16.7866668701171,16.3366661071777,16.7633323669433,54709500,0,0
2015-05-29 00:00:00-04:00,16.7333335876464,16.8579998016357,16.6286678314209,16.7199993133544,56839500,0,0
2015-06-01 00:00:00-04:00,16.7606678009033,16.7733325958251,16.4979991912841,16.6299991607666,37576500,0,0`;

        const parseCSV = (data) => {
            const lines = data.trim().split('\n');
            const headers = lines[0].split(',');
            
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const entry = {};
                
                headers.forEach((header, i) => {
                    if (header === 'Date') {
                        entry[header] = new Date(values[i]);
                    } else {
                        entry[header] = parseFloat(values[i]);
                    }
                });
                
                return entry;
            });
        };

        // Process data
        const stockData = parseCSV(csvData);
        
        // Set up dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
            document.getElementById('dark-icon').classList.remove('hidden');
        } else {
            document.getElementById('light-icon').classList.remove('hidden');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-icon').classList.remove('hidden');
                document.getElementById('light-icon').classList.add('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-icon').classList.add('hidden');
                document.getElementById('light-icon').classList.remove('hidden');
            }
            updateCharts();
        });
        
        document.getElementById('theme-toggle').addEventListener('click', () => {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-icon').classList.add('hidden');
                document.getElementById('light-icon').classList.remove('hidden');
            } else {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-icon').classList.remove('hidden');
                document.getElementById('light-icon').classList.add('hidden');
            }
            updateCharts();
        });
        
        // Format price for display
        const formatPrice = (price) => {
            return '$' + price.toFixed(2);
        };
        
        const formatChange = (change) => {
            const prefix = change >= 0 ? '+' : '';
            return prefix + change.toFixed(2) + '%';
        };
        
        const formatVolume = (volume) => {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(2) + 'K';
            }
            return volume.toString();
        };
        
        // Calculate statistics
        const calculateStats = (data) => {
            if (data.length === 0) return {};
            
            const lastPrice = data[data.length - 1].Close;
            const openPrice = data[data.length - 1].Open;
            
            // Calculate high and low for the current timeframe
            const highPrice = Math.max(...data.map(d => d.High));
            const lowPrice = Math.min(...data.map(d => d.Low));
            
            // Calculate change
            const prevClose = data.length > 1 ? data[data.length - 2].Close : data[0].Open;
            const priceChange = ((lastPrice - prevClose) / prevClose) * 100;
            
            // Calculate 30-day average and volatility
            const recent30Days = data.slice(-30);
            const avg30d = recent30Days.reduce((sum, d) => sum + d.Close, 0) / recent30Days.length;
            
            // Calculate standard deviation (volatility)
            const squaredDiffs = recent30Days.map(d => Math.pow(d.Close - avg30d, 2));
            const avgSquaredDiff = squaredDiffs.reduce((sum, val) => sum + val, 0) / squaredDiffs.length;
            const stdDev = Math.sqrt(avgSquaredDiff);
            const volatility = (stdDev / avg30d) * 100;
            
            return {
                lastPrice,
                openPrice,
                highPrice,
                lowPrice,
                volume: data[data.length - 1].Volume,
                priceChange,
                avg30d,
                volatility
            };
        };
        
        // Update the stats UI
        const updateStats = (stats) => {
            document.getElementById('current-price').textContent = formatPrice(stats.lastPrice);
            document.getElementById('open-price').textContent = formatPrice(stats.openPrice);
            document.getElementById('high-price').textContent = formatPrice(stats.highPrice);
            document.getElementById('low-price').textContent = formatPrice(stats.lowPrice);
            document.getElementById('volume').textContent = formatVolume(stats.volume);
            
            const priceChangeEl = document.getElementById('price-change');
            priceChangeEl.textContent = formatChange(stats.priceChange);
            
            if (stats.priceChange > 0) {
                priceChangeEl.classList.add('text-green-600');
                priceChangeEl.classList.remove('text-red-600');
            } else if (stats.priceChange < 0) {
                priceChangeEl.classList.add('text-red-600');
                priceChangeEl.classList.remove('text-green-600');
            } else {
                priceChangeEl.classList.remove('text-green-600', 'text-red-600');
            }
            
            document.getElementById('avg-30d').textContent = formatPrice(stats.avg30d);
            document.getElementById('volatility').textContent = stats.volatility.toFixed(2) + '%';
        };
        
        // Price chart
        let priceChart;
        let predictionChart;
        
        const createPriceChart = (data) => {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            const isDarkMode = document.documentElement.classList.contains('dark');
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const textColor = isDarkMode ? '#e0e0e0' : '#666666';
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Price',
                        data: data.map(item => ({
                            x: item.Date,
                            y: item.Close
                        })),
                        borderColor: '#5D5CDE',
                        backgroundColor: 'rgba(93, 92, 222, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month',
                                tooltipFormat: 'MMM d, yyyy'
                            },
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor,
                                callback: (value) => {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: (context) => {
                                    return 'Price: $' + context.parsed.y.toFixed(2);
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });
            
            document.getElementById('chart-loader').classList.add('hidden');
        };
        
        const createPredictionChart = (historicalData, predictedData) => {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            const isDarkMode = document.documentElement.classList.contains('dark');
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            const textColor = isDarkMode ? '#e0e0e0' : '#666666';
            
            // Get the last 30 days of historical data for better visualization
            const recentData = historicalData.slice(-30);
            
            if (predictionChart) {
                predictionChart.destroy();
            }
            
            predictionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Historical',
                            data: recentData.map(item => ({
                                x: item.Date,
                                y: item.Close
                            })),
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4,
                            fill: false
                        },
                        {
                            label: 'Predicted',
                            data: predictedData.map(item => ({
                                x: item.date,
                                y: item.price
                            })),
                            borderColor: '#FFA726',
                            backgroundColor: 'rgba(255, 167, 38, 0.1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 3,
                            pointHoverRadius: 5,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                tooltipFormat: 'MMM d, yyyy'
                            },
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor,
                                callback: (value) => {
                                    return '$' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: (context) => {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        },
                        legend: {
                            labels: {
                                color: textColor
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });
        };
        
        // Prediction methods
        const simpleMovingAverage = (data, days) => {
            const lookback = 7; // Use 7-day SMA
            
            // Get the closing prices from the last lookback days
            const prices = data.slice(-lookback).map(d => d.Close);
            const avg = prices.reduce((sum, price) => sum + price, 0) / prices.length;
            
            // Create prediction data
            const lastDate = new Date(data[data.length - 1].Date);
            const predictions = [];
            
            for (let i = 1; i <= days; i++) {
                const predictionDate = new Date(lastDate);
                predictionDate.setDate(lastDate.getDate() + i);
                
                predictions.push({
                    date: predictionDate,
                    price: avg
                });
            }
            
            return {
                predictions,
                confidence: 0.6 // Simple confidence score (60%)
            };
        };
        
        const exponentialMovingAverage = (data, days) => {
            const alpha = 0.3; // Smoothing factor
            
            // Start with the last known price
            let ema = data[data.length - 1].Close;
            
            // Create prediction data
            const lastDate = new Date(data[data.length - 1].Date);
            const predictions = [];
            
            // Predict using the most recent EMA value plus weighted recent trend
            const recentTrend = (data[data.length - 1].Close - data[data.length - 5].Close) / 5;
            
            for (let i = 1; i <= days; i++) {
                const predictionDate = new Date(lastDate);
                predictionDate.setDate(lastDate.getDate() + i);
                
                // Add small trend component
                ema = ema + (recentTrend * 0.5);
                
                predictions.push({
                    date: predictionDate,
                    price: ema
                });
            }
            
            return {
                predictions,
                confidence: 0.65 // 65% confidence
            };
        };
        
        const linearRegression = (data, days) => {
            // Use last 30 days for regression
            const recentData = data.slice(-30);
            
            // Create x (days) and y (prices) arrays
            const x = Array.from({length: recentData.length}, (_, i) => i);
            const y = recentData.map(d => d.Close);
            
            // Calculate linear regression coefficients
            // y = mx + b
            const n = x.length;
            const sum_x = x.reduce((a, b) => a + b, 0);
            const sum_y = y.reduce((a, b) => a + b, 0);
            const sum_xy = x.reduce((a, b, i) => a + b * y[i], 0);
            const sum_xx = x.reduce((a, b) => a + b * b, 0);
            
            const m = (n * sum_xy - sum_x * sum_y) / (n * sum_xx - sum_x * sum_x);
            const b = (sum_y - m * sum_x) / n;
            
            // Make predictions
            const lastDate = new Date(data[data.length - 1].Date);
            const predictions = [];
            
            for (let i = 1; i <= days; i++) {
                const predictionDate = new Date(lastDate);
                predictionDate.setDate(lastDate.getDate() + i);
                
                const predictedPrice = m * (n + i - 1) + b;
                
                predictions.push({
                    date: predictionDate,
                    price: predictedPrice
                });
            }
            
            // Calculate R-squared to determine confidence
            const mean_y = sum_y / n;
            const ss_total = y.reduce((a, b) => a + Math.pow(b - mean_y, 2), 0);
            const ss_residual = y.reduce((a, b, i) => a + Math.pow(b - (m * x[i] + b), 2), 0);
            const r_squared = 1 - (ss_residual / ss_total);
            
            return {
                predictions,
                confidence: Math.max(0.5, r_squared) // Minimum 50% confidence
            };
        };
        
        const makePrediction = (data, method, days) => {
            let result;
            
            switch (method) {
                case 'sma':
                    result = simpleMovingAverage(data, days);
                    break;
                case 'ema': 
                    result = exponentialMovingAverage(data, days);
                    break;
                case 'lr':
                    result = linearRegression(data, days);
                    break;
                default:
                    result = simpleMovingAverage(data, days);
            }
            
            return result;
        };
        
        const updatePredictionStats = (predictions, confidence) => {
            if (predictions.length === 0) return;
            
            document.getElementById('pred-1d').textContent = formatPrice(predictions[0].price);
            
            const day7 = predictions.length >= 7 ? predictions[6].price : predictions[predictions.length - 1].price;
            document.getElementById('pred-7d').textContent = formatPrice(day7);
            
            const day14 = predictions.length >= 14 ? predictions[13].price : predictions[predictions.length - 1].price;
            document.getElementById('pred-14d').textContent = formatPrice(day14);
            
            const day30 = predictions.length >= 30 ? predictions[29].price : predictions[predictions.length - 1].price;
            document.getElementById('pred-30d').textContent = formatPrice(day30);
            
            document.getElementById('pred-confidence').textContent = (confidence * 100).toFixed(1) + '%';
        };
        
        // Handle UI events
        document.querySelectorAll('.time-range-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                // Update active button style
                document.querySelectorAll('.time-range-btn').forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                });
                e.target.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                e.target.classList.add('bg-primary', 'text-white');
                
                // Filter data based on time range
                const range = e.target.dataset.range;
                let filteredData;
                
                if (range === 'all') {
                    filteredData = stockData;
                } else {
                    const days = parseInt(range);
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - days);
                    
                    filteredData = stockData.filter(item => item.Date >= cutoffDate);
                }
                
                // Update chart and stats
                if (priceChart) {
                    priceChart.data.datasets[0].data = filteredData.map(item => ({
                        x: item.Date,
                        y: item.Close
                    }));
                    priceChart.update();
                }
                
                const stats = calculateStats(filteredData);
                updateStats(stats);
            });
        });
        
        document.getElementById('predict-btn').addEventListener('click', () => {
            const method = document.getElementById('prediction-method').value;
            const days = parseInt(document.getElementById('prediction-days').value);
            
            if (isNaN(days) || days < 1 || days > 30) {
                alert('Please enter a valid number of days between 1 and 30.');
                return;
            }
            
            document.getElementById('prediction-loader').classList.remove('hidden');
            
            // Small delay to allow loader to appear
            setTimeout(() => {
                const result = makePrediction(stockData, method, days);
                createPredictionChart(stockData, result.predictions);
                updatePredictionStats(result.predictions, result.confidence);
                document.getElementById('prediction-loader').classList.add('hidden');
            }, 500);
        });
        
        // Function to update chart colors when theme changes
        const updateCharts = () => {
            if (priceChart) {
                const isDarkMode = document.documentElement.classList.contains('dark');
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? '#e0e0e0' : '#666666';
                
                priceChart.options.scales.x.grid.color = gridColor;
                priceChart.options.scales.y.grid.color = gridColor;
                priceChart.options.scales.x.ticks.color = textColor;
                priceChart.options.scales.y.ticks.color = textColor;
                priceChart.update();
            }
            
            if (predictionChart) {
                const isDarkMode = document.documentElement.classList.contains('dark');
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? '#e0e0e0' : '#666666';
                
                predictionChart.options.scales.x.grid.color = gridColor;
                predictionChart.options.scales.y.grid.color = gridColor;
                predictionChart.options.scales.x.ticks.color = textColor;
                predictionChart.options.scales.y.ticks.color = textColor;
                predictionChart.options.plugins.legend.labels.color = textColor;
                predictionChart.update();
            }
        };
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Default to 30 days view
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const filteredData = stockData.filter(item => item.Date >= thirtyDaysAgo);
            
            createPriceChart(filteredData);
            
            const stats = calculateStats(filteredData);
            updateStats(stats);
            
            // Initial prediction (7 days with SMA)
            const result = makePrediction(stockData, 'sma', 7);
            createPredictionChart(stockData, result.predictions);
            updatePredictionStats(result.predictions, result.confidence);
        });
    </script>
</body>
</html>